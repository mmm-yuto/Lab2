# Lab 2 使い方ガイド

このドキュメントでは、実装した3つのジェスチャーと音のマッピングの使い方を説明します。

## 前提条件

### GitHubリポジトリの準備

**フォーク（Fork）とは:**
- フォークとは、他の人のGitHubリポジトリを自分のアカウントにコピーすることです
- 元のリポジトリに影響を与えずに、自分のアカウントで自由に編集・変更できます
- このラボでは、教師のリポジトリ（https://github.com/mauriziobrt/DT2140-Sound-Interaction-Lab）をフォークして、自分のアカウントで作業します

**フォークの手順:**

1. **元のリポジトリにアクセス**
   - ブラウザで https://github.com/mauriziobrt/DT2140-Sound-Interaction-Lab にアクセス
   - GitHubにログインしていることを確認

2. **フォークボタンをクリック**
   - リポジトリページの右上にある「Fork」ボタンをクリック
   - 「Create a fork」という画面が表示されます

3. **フォーク先を選択**
   - 「Owner」で自分のアカウントが選択されていることを確認
   - 「Repository name」はそのままでOK（変更も可能）
   - 「Copy the main branch only」または「Copy all branches」を選択
   - 「Create fork」ボタンをクリック

4. **フォーク完了**
   - 数秒待つと、あなたのアカウントにリポジトリがコピーされます
   - URLは `https://github.com/<あなたのユーザー名>/DT2140-Sound-Interaction-Lab` になります
   - これが「フォークしたリポジトリ」です

**重要:**
- フォークしたリポジトリは、あなたのアカウントに完全にコピーされます
- 元のリポジトリ（教師のリポジトリ）には影響しません
- あなたのフォークしたリポジトリで自由に編集・変更できます

### 必要な環境
- **スマートフォン**（iOSまたはAndroid）
  - モーションセンサー（加速度計、ジャイロスコープ）が利用可能なデバイス
  - 最新のブラウザ（Chrome、Safari、Firefoxなど）
- **ラップトップ**（開発・テスト用）
- **ヘッドフォン**（推奨）

### 重要な注意事項
- **HTTPS環境が必要**: スマートフォンのセンサーAPIはHTTPS環境でないと動作しません
- **GitHub Pagesを使用**: ローカル開発サーバーを使用する場合は、HTTPS設定が必要です
- **ユーザーインタラクションが必要**: ブラウザのセキュリティポリシーにより、音の再生にはユーザーの操作（クリックやタップ）が必要です

## セットアップ方法

### 1. リポジトリのクローン
```bash
git clone <your-forked-repository-url>
cd DT2140-Sound-Interaction-Lab
```

### 2. ローカルサーバーの起動

#### オプション1: VS Code Live Server（推奨）

**Live Server拡張機能のインストール方法:**

1. **VS Codeを開く**
   - プロジェクトフォルダをVS Codeで開きます

2. **拡張機能パネルを開く**
   - 左側のサイドバーで拡張機能アイコン（四角が4つ並んだアイコン）をクリック
   - または、ショートカットキー: `Ctrl+Shift+X` (Windows/Linux) または `Cmd+Shift+X` (Mac)

3. **Live Serverを検索**
   - 検索ボックスに「Live Server」と入力
   - 「Live Server」by Ritwick Dey を探します（通常、最初の検索結果に表示されます）

4. **インストール**
   - 「Live Server」の「インストール」ボタンをクリック
   - インストールが完了すると、VS Codeの右下に通知が表示されます

5. **使用方法**
   - `index.html`を右クリック
   - コンテキストメニューから「Open with Live Server」を選択
   - または、VS Codeの右下にある「Go Live」ボタンをクリック
   - ブラウザが自動的に開き、`http://127.0.0.1:5500/index.html` にアクセスされます

**Live Serverの特徴:**
- ファイルを保存すると、ブラウザが自動的にリロードされます
- ローカルサーバーが起動するため、HTTPS環境ではありませんが、基本的な動作確認には使用できます
- ポート番号は通常5500ですが、設定で変更可能です

#### オプション2: Python HTTPサーバー
```bash
# Python 3の場合
python3 -m http.server 8000

# Python 2の場合
python -m SimpleHTTPServer 8000
```

ブラウザで `http://localhost:8000` にアクセス

### 3. スマートフォンでのアクセス

#### GitHub Pagesを使用する場合（推奨・HTTPS環境）

**GitHub Pagesの有効化手順:**

1. **GitHubリポジトリにアクセス**
   - ブラウザでGitHubにログインします
   - あなたのアカウントでフォークしたリポジトリを開きます
   - URLは `https://github.com/<あなたのユーザー名>/DT2140-Sound-Interaction-Lab` の形式です
   - まだフォークしていない場合は、上記の「GitHubリポジトリの準備」セクションを参照してください

2. **Settings（設定）を開く**
   - リポジトリページの上部にある「Settings」タブをクリック

3. **Pagesセクションを開く**
   - 左側のメニューから「Pages」をクリック
   - または、Settingsページを下にスクロールして「Pages」セクションを見つけます

4. **Source（ソース）を設定**
   - 「Source」のドロップダウンメニューで「Deploy from a branch」を選択
   - 「Branch」ドロップダウンメニューで「main」ブランチを選択（または「master」ブランチ）
   - フォルダのドロップダウンメニューで「/ (root)」を選択
   - 「Save」ボタンをクリック

5. **設定の確認**
   - 画面上部に「GitHub Pages source saved.」という緑色のメッセージが表示されます
   - これで設定は完了です
   - 「Enforce HTTPS」が自動的にオンになっていることを確認してください（デフォルトドメインを使用している場合）

6. **公開URLを確認**
   - 設定を保存した後、数秒〜数分待ちます
   - リポジトリのトップページに戻ります
   - リポジトリのトップページの右側にある「About」セクションを確認
   - または、Settings → Pages に戻ると、ページ上部に「Your site is live at」というメッセージが表示されます
   - URLは `https://<あなたのユーザー名>.github.io/DT2140-Sound-Interaction-Lab/` の形式になります
   - 例: `https://mmm-yuto.github.io/DT2140-Sound-Interaction-Lab/`
   - このURLをコピーします

**注意:** 
- GitHub Pagesのビルドには数分かかる場合があります
- すぐにアクセスできない場合は、5〜10分待ってから再度アクセスしてください
- 初回のデプロイには特に時間がかかることがあります

7. **スマートフォンでアクセス**
   - スマートフォンのブラウザを開く
   - コピーしたURLをアドレスバーに貼り付けてアクセス
   - **HTTPS環境のため、センサーが正常に動作します**

**注意:** GitHub Pagesの反映には数分かかる場合があります。すぐに表示されない場合は、数分待ってから再度アクセスしてください。

---

#### ローカルネットワークを使用する場合（開発・テスト用）

**前提条件:**
- ラップトップとスマートフォンが同じWi-Fiネットワークに接続されている必要があります
- ラップトップでローカルサーバーが起動している必要があります

**手順:**

1. **ラップトップとスマートフォンを同じWi-Fiに接続**
   - 両方のデバイスが同じWi-Fiネットワークに接続されていることを確認

2. **ラップトップのIPアドレスを確認**

   **Windowsの場合:**
   - コマンドプロンプトまたはPowerShellを開く
   - 以下のコマンドを実行:
     ```bash
     ipconfig
     ```
   - 「IPv4 アドレス」を探します（例: `192.168.1.100`）

   **Macの場合:**
   - ターミナルを開く
   - 以下のコマンドを実行:
     ```bash
     ifconfig | grep "inet "
     ```
   - 「inet」の後に表示されるIPアドレスを探します（例: `192.168.1.100`）
   - 通常、`192.168.x.x` または `10.0.x.x` の形式です

   **Linuxの場合:**
   - ターミナルを開く
   - 以下のコマンドを実行:
     ```bash
     hostname -I
     ```
   - または:
     ```bash
     ip addr show
     ```

3. **ローカルサーバーを起動**
   - VS Code Live Serverを使用している場合:
     - `index.html`を右クリック → "Open with Live Server"
     - 通常、ポート5500で起動します
   - Python HTTPサーバーを使用している場合:
     ```bash
     python3 -m http.server 8000
     ```
     - ポート8000で起動します

4. **ラップトップのファイアウォール設定を確認**
   - Windowsの場合:
     - コントロールパネル → システムとセキュリティ → Windows Defender ファイアウォール
     - 「詳細設定」→「受信の規則」→「新しい規則」
     - ポート番号（8000または5500）を許可する規則を追加
   - Macの場合:
     - システム環境設定 → セキュリティとプライバシー → ファイアウォール
     - 必要に応じて、PythonまたはNode.jsを許可

5. **スマートフォンでアクセス**
   - スマートフォンのブラウザを開く
   - 以下のURLを入力:
     - Live Serverの場合: `http://<ラップトップのIPアドレス>:5500/index.html`
     - Pythonサーバーの場合: `http://<ラップトップのIPアドレス>:8000/index.html`
   - 例: `http://192.168.1.100:5500/index.html`

**注意事項:**
- ローカルネットワークはHTTP環境のため、一部のセンサー機能が制限される場合があります
- スマートフォンでセンサーが動作しない場合は、GitHub Pagesを使用することを推奨します
- ラップトップのIPアドレスは、Wi-Fiネットワークに接続するたびに変わる可能性があります

## インタラクション方法

### Interaction 1: Shake → Thunder（振る → 雷）

#### 使い方
1. スマートフォンで `index.html` を開く
2. ページをタップして音声コンテキストを有効化（必要に応じて）
3. **"Turn On DSP"** ボタンをタップして音声処理を開始
4. センサーの許可を求められたら **"許可"** を選択
5. **スマートフォンを振る**と、雷の音が再生されます

#### 操作方法
- **ジェスチャー**: スマートフォンを手に持って前後左右に振る
- **検出方法**: p5.jsが自動的に加速度の変化を検出
- **音の再生**: 振るたびに雷の音（Thunder）が再生されます
- **調整**: 画面下部のスライダーで「shake threshold」を調整できます（0-100）

#### 期待される動作
- スマートフォンを振ると、雷の衝撃的な音が再生される
- 振る強さに関係なく、検出されれば同じ音が再生される
- 画面の「shaken」ラベルがピンク色に変わり、1秒後に黒に戻る

---

### Interaction 2: Point Straight Up → Bells（真上を指す → 鐘）

#### 使い方
1. スマートフォンで `sound2.html` を開く
2. ページをタップして音声コンテキストを有効化（必要に応じて）
3. **"Turn On DSP"** ボタンをタップして音声処理を開始
4. センサーの許可を求められたら **"許可"** を選択
5. **スマートフォンを真上に向ける**と、鐘の音が鳴ります

#### 操作方法
- **ジェスチャー**: スマートフォンを手に持って、画面が上を向くように真上に傾ける
- **検出方法**: デバイスのPitch角度（rotationY）が85°〜95°の範囲にあることを検出
- **音の再生**: 真上を向いた状態になると、鐘の音（Bells）が再生されます
- **連続検出防止**: 500msのクールダウンがあるため、連続して鐘が鳴ることはありません

#### 期待される動作
- スマートフォンを真上（約90°）に向けると、鐘の音が鳴る
- デバイスを真上に向けたままにすると、クールダウン後に再度鳴る可能性がある
- 角度が85°未満または95°を超えると、鐘は鳴らない

#### ヒント
- デバイスを垂直に立てるように持つと、90°に近づきやすい
- 画面に表示される「Rotation Y」の値を確認しながら調整できます

---

### Interaction 3: Tilt Side to Side → Brass（左右に傾ける → 金管楽器）

#### 使い方
1. スマートフォンで `sound3.html` を開く
2. ページをタップして音声コンテキストを有効化（必要に応じて）
3. **"Turn On DSP"** ボタンをタップして音声処理を開始
4. センサーの許可を求められたら **"許可"** を選択
5. **スマートフォンを左右に傾ける**と、金管楽器の音が変化します

#### 操作方法
- **ジェスチャー**: スマートフォンを平らに持ち、左右に傾ける
- **検出方法**: デバイスのRoll角度（rotationX）を検出
- **音の制御**: 傾きの角度に応じて、金管楽器の息の強さ（pressure）が変化します
  - **左に傾ける（-90°）**: 圧力 = 0.0（音が弱い）
  - **水平（0°）**: 圧力 = 0.5（中間）
  - **右に傾ける（+90°）**: 圧力 = 1.0（音が強い）

#### 期待される動作
- スマートフォンを左右に傾けると、金管楽器の音の強さとキャラクターが連続的に変化する
- 傾きの角度に応じて、リアルタイムで音が変化する
- より大きく傾けるほど、音が強くなる

#### ヒント
- デバイスを平らに持って、ゆっくりと左右に傾けると、音の変化を感じやすい
- 画面に表示される「Rotation X」の値を確認しながら調整できます
- デスクトップでテストする場合: マウスをクリックすると、マウスのX位置に応じて音が変化します

---

## 画面の表示内容

各ページには以下の情報が表示されます：

### センサーデータ表示
- **Acceleration X, Y, Z**: 加速度データ（リアルタイム更新）
- **Rotation X, Y, Z**: 回転データ（リアルタイム更新）
  - Rotation X = Roll (左右の傾き)
  - Rotation Y = Pitch (前後の傾き)
  - Rotation Z = Yaw (左右の回転)

### ステータス表示
- **shaken**: デバイスが振られたときにピンク色に変わる
- **turned**: デバイスが回転したときにピンク色に変わる
- **moved**: デバイスが動いたときにピンク色に変わる

### コントロール
- **Turn On DSP / Turn Off DSP**: 音声処理の開始/停止
- **shake threshold**: 振る検出の感度調整（0-100）
- **move threshold**: 動き検出の感度調整（0-75）

## トラブルシューティング

### 音が鳴らない場合
1. **"Turn On DSP"ボタンを押したか確認**
2. **センサーの許可を確認**: ブラウザの設定でモーションセンサーの許可が必要です
3. **HTTPS環境を確認**: HTTPではセンサーが動作しません
4. **音量を確認**: デバイスの音量設定を確認してください
5. **ヘッドフォンを接続**: 音が小さくて聞こえない場合があります

### ジェスチャーが検出されない場合
1. **センサーデータを確認**: 画面上のセンサーデータが更新されているか確認
2. **閾値を調整**: スライダーで検出感度を調整
3. **デバイスの向きを確認**: 正しい向きでデバイスを持っているか確認
4. **ブラウザを再読み込み**: ページを再読み込みしてみてください

### iOSでの注意事項
- iOS 13以降では、センサーへのアクセスに明示的な許可が必要です
- 初回アクセス時に許可を求められます
- 許可が拒否された場合、ブラウザの設定から手動で許可する必要があります

### Androidでの注意事項
- Chromeブラウザの使用を推奨
- 一部のデバイスでは、センサーの精度が異なる場合があります

## デバッグ方法

### デスクトップでのテスト
- **Interaction 1**: マウスをクリックすると雷の音が再生されます
- **Interaction 2**: デスクトップではテストできません（センサーが必要）
- **Interaction 3**: マウスをクリックすると、マウスのX位置に応じて音が変化します

### コンソールログの確認
ブラウザの開発者ツール（F12）でコンソールを開くと、以下の情報が表示されます：
- パラメータの最小値・最大値
- DSPノードの状態
- エラーメッセージ

## 技術的な詳細

### 使用している技術
- **p5.js**: センサーデータの取得とジェスチャー検出
- **Web Audio API**: 音の再生と制御
- **Faust WASM**: 音の合成（Thunder, Bells, Brass）
- **DeviceMotionEvent / DeviceOrientationEvent**: スマートフォンのセンサーデータ

### ファイル構成
- `index.html`: Interaction 1（Shake → Thunder）
- `sound2.html`: Interaction 2（Point Up → Bells）
- `sound3.html`: Interaction 3（Tilt → Brass）
- `interaction-1.js`, `interaction-2.js`, `interaction-3.js`: 各インタラクションの実装
- `sketch.js`: p5.jsのセットアップとセンサーデータの取得
- `dsp.js`: Faust WASMのローダー
- `helpers.js`: ユーティリティ関数

## 次のステップ

実装を完了したら：
1. **GitHubにプッシュ**: 変更をコミットしてプッシュ
2. **GitHub Pagesを有効化**: リポジトリの設定からGitHub Pagesを有効化
3. **テスト**: スマートフォンで公開されたURLにアクセスしてテスト
4. **提出**: CanvasにGitHub PagesのURLとリポジトリのURLを提出

## 参考資料

- [MAPPINGS.md](DT2140-Sound-Interaction-Lab/MAPPINGS.md): マッピングの詳細な説明と動機付け
- [README.md](DT2140-Sound-Interaction-Lab/README.md): プロジェクトの概要とセットアップ手順

